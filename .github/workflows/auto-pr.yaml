name: Auto PR from ci-cd to main

on:
  push:
    branches:
      - ci-cd
jobs:
  create-pr:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Create Pull Request
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          # ì´ë¯¸ PRì´ ì—´ë ¤ ìˆëŠ”ì§€ ì²´í¬
          PR_EXISTS=$(gh pr list --base main --head ci-cd --state open --json number --jq 'length')
          if [ "$PR_EXISTS" -eq 0 ]; then
            gh pr create \
              --base main \
              --head ci-cd \
              --title "ìë™ PR: ci-cd â†’ main" \
              --body "ci-cd ë¸Œëœì¹˜ì—ì„œ main ë¸Œëœì¹˜ë¡œ ìë™ ìƒì„±ëœ PRì…ë‹ˆë‹¤."
          else
            PR_NUMBER=$(gh pr list --base main --head ci-cd --state open --json number --jq '.[0].number')
            gh pr comment $PR_NUMBER --body "ğŸ¤– ìƒˆë¡œìš´ ì»¤ë°‹ì´ í‘¸ì‹œë˜ì—ˆìŠµë‹ˆë‹¤!"
          fi
