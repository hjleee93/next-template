name: Auto PR from ci-cd to main

on:
  push:
    branches:
      - ci-cd
jobs:
  create-pr:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Create Pull Request
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          # 이미 PR이 열려 있는지 체크
          PR_EXISTS=$(gh pr list --base main --head ci-cd --state open --json number --jq 'length')
          if [ "$PR_EXISTS" -eq 0 ]; then
            gh pr create \
              --base main \
              --head ci-cd \
              --title "자동 PR: ci-cd → main" \
              --body "ci-cd 브랜치에서 main 브랜치로 자동 생성된 PR입니다."
          else
            PR_NUMBER=$(gh pr list --base main --head ci-cd --state open --json number --jq '.[0].number')
            gh pr comment $PR_NUMBER --body "🤖 새로운 커밋이 푸시되었습니다!"
          fi
